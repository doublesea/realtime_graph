# 实时多信号绘图系统

基于 Python NiceGUI 和 ECharts 的实时多信号绘图系统，支持多个信号的实时数据可视化。

## 功能特性

- ✅ **实时数据更新**：支持 200ms 更新频率的实时数据绘制
- ✅ **滑动窗口显示**：数据量过大时自动显示最近 1 分钟的数据
- ✅ **多子图布局**：支持最多 20 个信号上下排列显示，每个子图独立标题
- ✅ **共享时间轴**：所有子图共享时间轴，方便对比分析，时间轴仅在底部显示
- ✅ **智能悬停提示**：鼠标悬停时显示格式化的时间戳（只显示一次）和所有信号的精确数值
- ✅ **自适应布局**：
  - 信号少（1-4个）：子图自动变大，充满整个页面
  - 信号适中（5-10个）：动态调整子图高度，刚好充满页面
  - 信号多（10个以上）：使用最小高度，页面可滚动查看
- ✅ **可配置参数**：支持自定义信号数量、更新频率和采样率
- ✅ **数据模拟**：内置数据生成器，使用正弦波模拟真实设备数据
- ✅ **高性能渲染**：采用 ECharts 前端渲染，支持大数据量实时更新

## 技术栈

- **NiceGUI** (v1.4+)：Python Web UI 框架
- **ECharts** (v5.4+)：高性能数据可视化库（前端渲染）
- **Pandas** (v2.0+)：数据处理和分析
- **NumPy** (v1.24+)：数值计算

## 安装

1. 克隆仓库：
```bash
git clone https://github.com/doublesea/realtime_graph.git
cd realtime_graph
```

2. 安装依赖：
```bash
pip install -r requirements.txt
```

## 使用

运行主程序：

```bash
python main.py
```

然后在浏览器中访问显示的地址（默认 http://localhost:8080）。

### 界面操作

1. **配置参数**：
   - 设置信号数量（1-20，默认4）
   - 设置更新频率（50-1000ms，默认200ms）
   - 设置采样频率（0.1-100Hz，默认5Hz）

2. **控制按钮**：
   - **启动**：开始实时绘图
   - **停止**：暂停数据更新
   - **重置**：清空数据并重新配置

3. **图表交互**：
   - **悬停查看**：鼠标悬停在曲线上查看精确数值
   - **Ctrl + 滚轮**：缩放时间轴
   - **拖拽**：平移查看历史数据

## 项目结构

```
.
├── main.py              # 主程序入口，NiceGUI界面和控制逻辑
├── data_generator.py    # 数据生成器，模拟实时信号数据
├── realtime_plot.py     # 实时绘图模块，ECharts配置
├── requirements.txt     # 依赖包列表
└── README.md           # 项目文档
```

## 核心模块说明

### data_generator.py

数据生成器类，用于模拟实时设备数据：

- **生成方式**：使用正弦波 + 随机噪声模拟真实信号
- **数据格式**：DataFrame格式，包含timestamp和多个signal列
- **滑动窗口**：支持获取指定时间窗口内的数据（默认60秒）

### realtime_plot.py

ECharts 图表配置和管理：

- **多子图布局**：每个信号独立子图，垂直排列
- **动态高度**：根据信号数量自动调整子图高度
- **时间轴配置**：格式化显示（HH:mm:ss.SSS）
- **性能优化**：
  - 禁用动画（animation: false）
  - 大数据模式（large: true）
  - LTTB采样算法（sampling: 'lttb'）

### main.py

主程序和用户界面：

- **NiceGUI 界面**：参数配置、控制按钮、图表显示
- **定时器**：使用 ui.timer 实现定时数据更新
- **自定义 Tooltip**：通过 JavaScript 注入实现格式化的悬停提示

## 配置说明

### 推荐配置

| 场景 | 信号数量 | 更新频率 | 采样频率 |
|------|---------|---------|---------|
| 快速预览 | 4 | 200ms | 5Hz |
| 详细分析 | 8-10 | 200ms | 10Hz |
| 高频采集 | 4-6 | 100ms | 20Hz |
| 多路监控 | 15-20 | 500ms | 5Hz |

### 性能建议

- 信号数量 × 更新频率 ≤ 100（如：20信号 × 5Hz = 100）
- 采样率不要超过更新频率的2倍
- 浏览器内存充足时可增加信号数量

## Tooltip 显示格式

悬停时显示的信息格式：

```
┌──────────────────────────┐
│ Time: 14:23:45.123       │ ← 时间戳只显示一次
├──────────────────────────┤
│ ● Signal 1      2.345    │
│ ● Signal 2     -1.234    │
│ ● Signal 3      0.567    │
│ ● Signal 4      3.456    │
└──────────────────────────┘
```

## 自定义数据源

要使用真实设备数据，修改 `data_generator.py` 中的 `DataGenerator` 类：

```python
def generate_next_data(self):
    """生成下一个数据点"""
    # 替换为从真实设备读取数据
    # 返回格式：timestamp 和 signal_1, signal_2, ... 的值
    # 例如：
    # timestamp = datetime.now()
    # values = read_from_device()  # 从设备读取数据
    # self.data['timestamp'].append(timestamp)
    # for i, value in enumerate(values):
    #     self.data[f'signal_{i+1}'].append(value)
```

## 已知限制

- 最多支持 20 个信号同时显示
- 数据窗口固定为 60 秒
- 时间戳显示为本地时间

## 故障排除

### 图表不显示

- 检查浏览器控制台是否有 JavaScript 错误
- 确认已安装所有依赖包
- 尝试刷新浏览器页面

### 更新卡顿

- 减少信号数量
- 降低更新频率
- 降低采样频率

### Tooltip 显示异常

- 刷新浏览器页面
- 清除浏览器缓存
- 确认使用现代浏览器（Chrome 90+、Edge 90+、Firefox 88+）

## 未来改进

- [ ] 支持自定义数据源接入
- [ ] 添加数据导出功能（CSV/Excel）
- [ ] 支持多种图表类型切换（折线图/散点图/柱状图）
- [ ] 添加信号统计信息显示（最大值/最小值/平均值）
- [ ] 支持主题切换（亮色/暗色）
- [ ] 添加信号颜色自定义
- [ ] 支持Y轴范围手动设置

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 联系方式

如有问题，请在 GitHub 上提交 Issue。
